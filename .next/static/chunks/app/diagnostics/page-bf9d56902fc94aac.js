(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[149],{25:(e,r,a)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,r){for(var a in r)Object.defineProperty(e,a,{enumerable:!0,get:r[a]})}(r,{callServer:function(){return s.callServer},createServerReference:function(){return l},findSourceMapURL:function(){return t.findSourceMapURL}});let s=a(4770),t=a(526),l=a(2207).createServerReference},2656:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(7211).A)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},3845:(e,r,a)=>{Promise.resolve().then(a.bind(a,8283))},6345:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(7211).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},6896:(e,r,a)=>{"use strict";a.d(r,{A:()=>s});let s=(0,a(7211).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7348:(e,r,a)=>{"use strict";a.d(r,{B:()=>t});var s=a(25);let t=(0,s.createServerReference)("00478ff53a27e04f76aa952f3b5e32f32d3de84303",s.callServer,void 0,s.findSourceMapURL,"syncPendingBooksAction")},8283:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>S});var s=a(4727),t=a(8319),l=a(2822),i=a.n(l),o=a(184),c=a(6896),n=a(6345),d=a(2656),u=a(7211);let m=(0,u.A)("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),h=(0,u.A)("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);var x=a(8808),p=a(6593),b=a(444);async function f(){try{console.log("Iniciando prueba de conexi\xf3n a Supabase...");let e=(0,x.UU)(),{data:r,error:a}=await e.from("books").select("id").limit(1);if(a)return console.error("Error en la prueba de conexi\xf3n:",a),{success:!1,error:"Error al conectar con Supabase",details:a};return console.log("Conexi\xf3n exitosa a Supabase:",r),{success:!0,data:r}}catch(e){return console.error("Excepci\xf3n en la prueba de conexi\xf3n:",e),{success:!1,error:"Error al conectar con Supabase",details:e}}}async function y(){try{console.log("Verificando tabla books...");let e=(0,x.UU)(),{data:r,error:a}=await e.from("books").select("*").limit(1);if(a)return console.error("Error al verificar tabla books:",a),{success:!1,message:"Error al verificar tabla books",error:a};return console.log("Tabla books verificada:",r),{success:!0,message:"La tabla books existe",sample:r}}catch(e){return console.error("Excepci\xf3n al verificar tabla books:",e),{success:!1,message:"Error al verificar tabla books",error:e}}}async function g(){try{console.log("Probando pol\xedticas RLS...");let e=(0,x.UU)(),r=(0,p.F6)();console.log("ID de usuario para prueba RLS:",r);let{data:a,error:s}=await e.from("information_schema.columns").select("column_name").eq("table_name","books").eq("column_name","local_id").single(),t=!s&&a;console.log("\xbfExiste la columna local_id?",t?"S\xed":"No");let l={title:"Libro de prueba RLS",author:"Sistema",type:"read",user_id:r};t&&(l.local_id="test-".concat(Date.now())),console.log("Intentando insertar libro de prueba:",l);let{data:i,error:o}=await e.from("books").insert([l]).select();if(o)return console.error("Error al insertar libro de prueba (posible problema con RLS):",o),{success:!1,error:"Error al insertar un libro de prueba (posible problema con RLS)",details:o,hasLocalIdColumn:t};if(console.log("Libro de prueba insertado correctamente:",i),i&&i.length>0){let{error:r}=await e.from("books").delete().eq("id",i[0].id);r?console.error("Error al eliminar libro de prueba:",r):console.log("Libro de prueba eliminado correctamente")}return{success:!0,message:"Las pol\xedticas RLS permiten insertar libros",hasLocalIdColumn:t}}catch(e){return console.error("Excepci\xf3n al probar pol\xedticas RLS:",e),{success:!1,error:"Error al probar pol\xedticas RLS",details:e}}}async function v(){try{let e=(0,p.F6)();return console.log("ID de usuario actual:",e),{success:!0,userId:e}}catch(e){return console.error("Error al obtener ID de usuario:",e),{success:!1,error:"Error al obtener ID de usuario",details:e}}}async function j(){let e=await f(),r=await y(),a=await g();return{connection:e,table:r,rls:a,userId:await v(),localStorage:function(){try{let e=localStorage.getItem(b.HQ),r=e?JSON.parse(e):[],a=r.filter(e=>e.pending_sync);return console.log("Libros en almacenamiento local:",r.length),console.log("Libros pendientes de sincronizaci\xf3n:",a.length),{success:!0,totalBooks:r.length,pendingBooks:a.length,sample:r.slice(0,2)}}catch(e){return console.error("Error al verificar almacenamiento local:",e),{success:!1,error:"Error al verificar almacenamiento local",details:e}}}()}}var N=a(7348),w=a(1375),k=a(9173);function S(){let[e,r]=(0,t.useState)(!1),[a,l]=(0,t.useState)({}),[u,x]=(0,t.useState)([]);(0,t.useEffect)(()=>{x((0,k.M7)())},[]);let p=async()=>{r(!0),l({});try{let e=await j();l(e),console.log("Resultados completos:",e),x((0,k.M7)())}catch(e){console.error("Error en diagn\xf3stico:",e),l(r=>({...r,error:e}))}finally{r(!1)}},b=async()=>{r(!0);try{let e=await (0,N.B)();e.success?(0,w.o)({title:"Sincronizaci\xf3n completada",description:e.message}):(0,w.o)({title:"Error de sincronizaci\xf3n",description:e.message,variant:"destructive"}),l(r=>({...r,sync:e})),x((0,k.M7)())}catch(e){console.error("Error al sincronizar:",e),(0,w.o)({title:"Error de sincronizaci\xf3n",description:"Ocurri\xf3 un error inesperado",variant:"destructive"})}finally{r(!1)}},f=async()=>{r(!0);try{let e=await (0,k.HQ)();e.success?(0,w.o)({title:"Inicializaci\xf3n completada",description:"Se cargaron ".concat(e.count," libros desde Supabase")}):(0,w.o)({title:"Error de inicializaci\xf3n",description:"No se pudieron cargar los libros desde Supabase",variant:"destructive"}),l(r=>({...r,init:e})),x((0,k.M7)())}catch(e){console.error("Error al inicializar:",e),(0,w.o)({title:"Error de inicializaci\xf3n",description:"Ocurri\xf3 un error inesperado",variant:"destructive"})}finally{r(!1)}};return(0,s.jsx)("div",{className:"min-h-screen bg-[#FDFCFB] p-6",children:(0,s.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,s.jsxs)("header",{className:"mb-8 flex items-center",children:[(0,s.jsx)(i(),{href:"/dashboard",className:"mr-4",children:(0,s.jsx)(c.A,{className:"h-5 w-5 text-[#888888]"})}),(0,s.jsx)("h1",{className:"font-serif text-2xl font-normal text-[#222222]",children:"Diagn\xf3stico"})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,s.jsx)("h2",{className:"mb-4 font-serif text-xl text-[#222222]",children:"Herramientas de diagn\xf3stico"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(o.$,{className:"w-full justify-start",variant:"outline",onClick:p,disabled:e,children:[e?(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(d.A,{className:"mr-2 h-4 w-4"}),"Verificar conexi\xf3n con Supabase"]}),(0,s.jsxs)(o.$,{className:"w-full justify-start",variant:"outline",onClick:b,disabled:e,children:[e?(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(m,{className:"mr-2 h-4 w-4"}),"Sincronizar libros pendientes"]}),(0,s.jsxs)(o.$,{className:"w-full justify-start",variant:"outline",onClick:f,disabled:e,children:[e?(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(h,{className:"mr-2 h-4 w-4"}),"Reinicializar almacenamiento local"]})]})]}),Object.keys(a).length>0&&(0,s.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,s.jsx)("h2",{className:"mb-4 font-serif text-xl text-[#222222]",children:"Resultados"}),(0,s.jsx)("pre",{className:"bg-gray-100 p-4 rounded-lg text-xs overflow-auto max-h-96",children:JSON.stringify(a,null,2)})]}),(0,s.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,s.jsx)("h2",{className:"mb-4 font-serif text-xl text-[#222222]",children:"Libros en almacenamiento local"}),u.length>0?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("p",{className:"text-sm text-[#888888]",children:["Total: ",u.length," libros"]}),(0,s.jsxs)("p",{className:"text-sm text-[#888888]",children:["Pendientes de sincronizar: ",u.filter(e=>e.pending_sync).length," libros"]}),(0,s.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg text-xs overflow-auto max-h-96",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left p-1",children:"ID"}),(0,s.jsx)("th",{className:"text-left p-1",children:"T\xedtulo"}),(0,s.jsx)("th",{className:"text-left p-1",children:"Autor"}),(0,s.jsx)("th",{className:"text-left p-1",children:"Tipo"}),(0,s.jsx)("th",{className:"text-left p-1",children:"Pendiente"})]})}),(0,s.jsx)("tbody",{children:u.map(e=>(0,s.jsxs)("tr",{className:"border-t border-gray-200",children:[(0,s.jsx)("td",{className:"p-1",children:e.id||e.local_id}),(0,s.jsx)("td",{className:"p-1",children:e.title}),(0,s.jsx)("td",{className:"p-1",children:e.author}),(0,s.jsx)("td",{className:"p-1",children:e.type}),(0,s.jsx)("td",{className:"p-1",children:e.pending_sync?"S\xed":"No"})]},e.id||e.local_id))})]})})]}):(0,s.jsx)("p",{className:"text-center text-[#888888]",children:"No hay libros en el almacenamiento local"})]})]})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[228,520,569,246,79,296,358],()=>r(3845)),_N_E=e.O()}]);