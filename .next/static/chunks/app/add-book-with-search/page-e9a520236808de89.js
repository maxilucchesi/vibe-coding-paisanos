(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[738],{510:(e,s,t)=>{"use strict";t.d(s,{AddBookFormWithSearch:()=>S});var a=t(4727),l=t(8319),r=t(2822),i=t.n(r),n=t(1435),o=t(184),c=t(7972),d=t(554),u=t(3474),h=t(8315),m=t(1507),x=t(6896),p=t(1800),g=t(3074),b=t(643),j=t(1375),v=t(3101),N=t(6593),f=t(4854),y=t(5499),w=t(1569),F=t(2280),k=t(550),C=t(3345);function E(e){let{onSelectBook:s,initialQuery:t=""}=e,[r,i]=(0,l.useState)(t),[n,d]=(0,l.useState)([]),[u,h]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!1),p=async()=>{if(!r.trim()){d([]);return}h(!0),x(!0);try{let e=await (0,k.Ve)(r);d(e)}catch(e){console.error("Error en la b\xfasqueda:",e)}finally{h(!1)}},g=e=>{s((0,k.Xw)(e)),d([])};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(c.p,{value:r,onChange:e=>i(e.target.value),placeholder:"Buscar por t\xedtulo o autor...",className:"pr-8 h-12",onKeyDown:e=>"Enter"===e.key&&p()}),r&&(0,a.jsx)("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:()=>i(""),children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]}),(0,a.jsx)(o.$,{onClick:p,variant:"default",size:"icon",disabled:u||!r.trim(),className:"h-12 w-12 bg-[#D0E2FF] text-[#222222] hover:bg-[#FFA69E]",children:(0,a.jsx)(w.A,{className:"h-5 w-5"})})]}),u?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(C.E,{className:"h-20 w-full"}),(0,a.jsx)(C.E,{className:"h-20 w-full"}),(0,a.jsx)(C.E,{className:"h-20 w-full"})]}):n.length>0?(0,a.jsx)("div",{className:"max-h-[calc(100vh-250px)] overflow-y-auto space-y-2 rounded-md border p-1",children:n.map(e=>{var s,t;return(0,a.jsxs)("button",{className:"flex w-full items-start gap-3 rounded-md p-3 text-left hover:bg-gray-100 transition-colors",onClick:()=>g(e),children:[(null===(s=e.volumeInfo.imageLinks)||void 0===s?void 0:s.smallThumbnail)?(0,a.jsx)("img",{src:e.volumeInfo.imageLinks.smallThumbnail||"/placeholder.svg",alt:e.volumeInfo.title,className:"h-20 w-14 object-cover rounded-sm"}):(0,a.jsx)("div",{className:"flex h-20 w-14 items-center justify-center rounded-sm bg-gray-200",children:(0,a.jsx)(F.A,{className:"h-6 w-6 text-gray-400"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-medium text-sm line-clamp-1",children:e.volumeInfo.title}),(0,a.jsx)("p",{className:"text-xs text-gray-500 line-clamp-1",children:(null===(t=e.volumeInfo.authors)||void 0===t?void 0:t.join(", "))||"Autor desconocido"}),(0,a.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:[e.volumeInfo.publishedDate&&"".concat(e.volumeInfo.publishedDate," \xb7 "),e.volumeInfo.publisher]}),e.volumeInfo.categories&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.volumeInfo.categories.slice(0,2).map((e,s)=>(0,a.jsx)("span",{className:"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-600",children:e},s))})]})]},e.id)})}):m&&r.trim()?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsxs)("p",{className:"mb-2",children:['No se encontraron resultados para "',r,'"']}),(0,a.jsx)("p",{className:"text-sm",children:"Intenta con otro t\xedtulo o autor"})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,a.jsx)(F.A,{className:"h-12 w-12 mx-auto mb-2 opacity-30"}),(0,a.jsx)("p",{className:"text-sm",children:"Busca por t\xedtulo, autor o ISBN"})]})]})}let A=()=>new Date().toISOString().split("T")[0];function S(){let[e,s]=(0,l.useState)(!1),[t,r]=(0,l.useState)("read"),[y,w]=(0,l.useState)(0),[F,k]=(0,l.useState)(null),[C,S]=(0,l.useState)(null),_=(0,n.useRouter)(),[I,D]=(0,l.useState)({title:"",author:"",date_finished:A(),review:"",published_date:"",description:"",categories:[],thumbnail:"",page_count:0,publisher:"",isbn:""}),[z,B]=(0,l.useState)(!1),[J,L]=(0,l.useState)(!1),[T,$]=(0,l.useState)(!1),[q,V]=(0,l.useState)(!1),R=e=>{let{id:s,value:t}=e.target;D(e=>({...e,[s]:t}))},O=async e=>{e.preventDefault(),s(!0),k(null),S(null);try{if(!(0,N.wR)())throw Error("Debes iniciar sesi\xf3n para guardar un libro");if(!I.title.trim())throw Error("El t\xedtulo del libro es obligatorio");if(!I.author.trim())throw Error("El autor del libro es obligatorio");let e={title:I.title.trim(),author:I.author.trim(),type:t,..."read"===t&&{rating:y>0?y:null,date_finished:I.date_finished||null,review:I.review.trim()||null},published_date:I.published_date||null,description:I.description||null,categories:I.categories.length>0?I.categories:null,thumbnail:I.thumbnail||null,page_count:I.page_count>0?I.page_count:null,publisher:I.publisher||null,isbn:I.isbn||null};console.log("Enviando datos del libro:",e),(0,j.o)({title:"Guardando libro...",description:"Tu libro est\xe1 siendo guardado."});let s=await (0,v.Q)(e);if(console.log("Resultado de createBookAction:",s),s.success){if(s.clientSideCode)try{let e={...s.book,pending_sync:!0},t=JSON.parse(localStorage.getItem("giuli-books")||"[]");t.push(e),localStorage.setItem("giuli-books",JSON.stringify(t)),console.log("Libro guardado en localStorage desde el cliente:",e),window.dispatchEvent(new CustomEvent("booksUpdated",{detail:t}))}catch(e){console.error("Error al guardar en localStorage desde el cliente:",e)}S(s.message),(0,j.o)({title:"\xa1Libro guardado!",description:s.message}),D({title:"",author:"",date_finished:A(),review:"",published_date:"",description:"",categories:[],thumbnail:"",page_count:0,publisher:"",isbn:""}),w(0),setTimeout(()=>{_.push("/dashboard"),_.refresh()},1500)}else throw Error(s.message||"Error al guardar el libro")}catch(s){console.error("Error saving book:",s);let e=s instanceof Error?s.message:"Hubo un problema al guardar tu libro. Por favor, int\xe9ntalo de nuevo.";k(e),(0,j.o)({title:"Error",description:e,variant:"destructive"})}finally{s(!1)}};return(0,a.jsx)("div",{className:"min-h-screen bg-[#FDFCFB] p-6",children:(0,a.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,a.jsxs)("header",{className:"mb-8 flex items-center",children:[(0,a.jsx)(i(),{href:"/dashboard",className:"mr-4",children:(0,a.jsx)(x.A,{className:"h-5 w-5 text-[#888888]"})}),(0,a.jsx)("h1",{className:"font-serif text-2xl font-normal text-[#222222]",children:z?"Completar detalles":"Buscar un libro"})]}),(0,a.jsx)(f.v,{}),F&&(0,a.jsx)("div",{className:"mb-6 rounded-lg bg-red-500 p-4 text-white",children:(0,a.jsx)("p",{children:F})}),C&&(0,a.jsx)("div",{className:"mb-6 rounded-lg bg-green-500 p-4 text-white",children:(0,a.jsx)("p",{children:C})}),z?(0,a.jsxs)("form",{className:"space-y-8",onSubmit:O,children:[(0,a.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,a.jsxs)(h.z,{defaultValue:"read",className:"mb-6 flex rounded-full bg-[#F5F5F5] p-1",onValueChange:r,children:[(0,a.jsxs)("div",{className:"w-1/2",children:[(0,a.jsx)(h.C,{value:"read",id:"read",className:"peer sr-only"}),(0,a.jsx)(u.J,{htmlFor:"read",className:"flex cursor-pointer justify-center rounded-full py-2 text-center text-sm peer-data-[state=checked]:bg-[#D0E2FF] peer-data-[state=checked]:text-[#222222] text-[#888888] transition-all duration-200",children:"Le\xeddo"})]}),(0,a.jsxs)("div",{className:"w-1/2",children:[(0,a.jsx)(h.C,{value:"wishlist",id:"wishlist",className:"peer sr-only"}),(0,a.jsx)(u.J,{htmlFor:"wishlist",className:"flex cursor-pointer justify-center rounded-full py-2 text-center text-sm peer-data-[state=checked]:bg-[#D0E2FF] peer-data-[state=checked]:text-[#222222] text-[#888888] transition-all duration-200",children:"Wishlist"})]})]}),I.thumbnail&&(0,a.jsx)("div",{className:"mb-6 flex justify-center",children:(0,a.jsx)("img",{src:I.thumbnail||"/placeholder.svg",alt:I.title,className:"h-52 rounded-md shadow-md"})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"title",className:"text-sm text-[#888888]",children:"T\xedtulo del libro"}),J?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.p,{id:"title",value:I.title,onChange:R,className:"rounded-lg border-[#D0E2FF] bg-white px-4 py-2 text-[#222222] placeholder:text-[#CCCCCC] focus:border-[#FFA69E] focus:ring-[#FFA69E]",placeholder:"Ingresa el t\xedtulo del libro",required:!0,autoFocus:!0}),(0,a.jsx)(o.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0 text-gray-400",onClick:()=>L(!1),children:"âœ“"})]}):(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-transparent bg-gray-50 px-4 py-2",children:[(0,a.jsx)("p",{className:"text-[#222222] font-medium",children:I.title||"Sin t\xedtulo"}),(0,a.jsx)(o.$,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-gray-400 hover:text-[#FFA69E]",onClick:()=>L(!0),children:(0,a.jsx)(p.A,{className:"h-3.5 w-3.5"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"author",className:"text-sm text-[#888888]",children:"Autor"}),T?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.p,{id:"author",value:I.author,onChange:R,className:"rounded-lg border-[#D0E2FF] bg-white px-4 py-2 text-[#222222] placeholder:text-[#CCCCCC] focus:border-[#FFA69E] focus:ring-[#FFA69E]",placeholder:"Ingresa el nombre del autor",required:!0,autoFocus:!0}),(0,a.jsx)(o.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0 text-gray-400",onClick:()=>$(!1),children:"âœ“"})]}):(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-transparent bg-gray-50 px-4 py-2",children:[(0,a.jsx)("p",{className:"text-[#222222]",children:I.author||"Sin autor"}),(0,a.jsx)(o.$,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-gray-400 hover:text-[#FFA69E]",onClick:()=>$(!0),children:(0,a.jsx)(p.A,{className:"h-3.5 w-3.5"})})]})]}),(I.published_date||I.publisher)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{className:"text-sm text-[#888888]",children:"Informaci\xf3n de publicaci\xf3n"}),(0,a.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 text-sm",children:[I.published_date&&(0,a.jsxs)("p",{className:"text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Fecha de publicaci\xf3n:"})," ",I.published_date]}),I.publisher&&(0,a.jsxs)("p",{className:"text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Editorial:"})," ",I.publisher]}),I.page_count>0&&(0,a.jsxs)("p",{className:"text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"P\xe1ginas:"})," ",I.page_count]}),I.isbn&&(0,a.jsxs)("p",{className:"text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"ISBN:"})," ",I.isbn]})]})]}),I.categories&&I.categories.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{className:"text-sm text-[#888888]",children:"Categor\xedas"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:I.categories.map((e,s)=>(0,a.jsx)("span",{className:"rounded-full bg-gray-100 px-2 py-1 text-xs text-gray-600",children:e},s))})]}),I.description&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{className:"text-sm text-[#888888]",children:"Sinopsis"}),(0,a.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 text-sm",children:[(0,a.jsx)("p",{className:"text-gray-600",children:q?I.description:function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return!e||e.length<=s?e:e.substring(0,s)+"..."}(I.description)}),I.description.length>200&&(0,a.jsx)(o.$,{type:"button",variant:"ghost",size:"sm",className:"mt-2 h-6 text-xs text-blue-500 hover:text-blue-700 flex items-center",onClick:()=>V(!q),children:q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.A,{className:"h-3 w-3 mr-1"})," Ver menos"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.A,{className:"h-3 w-3 mr-1"})," Ver m\xe1s"]})})]})]}),"read"===t&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"date_finished",className:"text-sm text-[#888888]",children:"Fecha de finalizaci\xf3n"}),(0,a.jsx)(c.p,{id:"date_finished",type:"date",value:I.date_finished,onChange:R,className:"rounded-lg border-[#D0E2FF] bg-white px-4 py-2 text-[#222222] focus:border-[#FFA69E] focus:ring-[#FFA69E]"})]}),"read"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{className:"text-sm text-[#888888]",children:"Valoraci\xf3n"}),(0,a.jsx)(m.G,{rating:y,setRating:w})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"review",className:"text-sm text-[#888888]",children:"Tus pensamientos"}),(0,a.jsx)(d.T,{id:"review",value:I.review,onChange:R,className:"min-h-[100px] rounded-lg border-[#D0E2FF] bg-white px-4 py-2 text-[#222222] placeholder:text-[#CCCCCC] focus:border-[#FFA69E] focus:ring-[#FFA69E]",placeholder:"Escribe tus pensamientos sobre este libro..."})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(o.$,{type:"submit",className:"h-12 w-full rounded-full bg-[#D0E2FF] text-[#222222] hover:bg-[#FFA69E] transition-all duration-300",disabled:e,children:e?"Guardando...":"Guardar libro"}),(0,a.jsx)(o.$,{type:"button",variant:"outline",className:"h-12 w-full rounded-full border-[#888888] text-[#888888] hover:bg-[#F5F5F5] transition-all duration-300",onClick:()=>B(!1),children:"Buscar otro libro"}),(0,a.jsx)(i(),{href:"/dashboard",children:(0,a.jsx)(o.$,{type:"button",variant:"ghost",className:"h-12 w-full rounded-full text-[#888888] hover:bg-[#F5F5F5] transition-all duration-300",children:"Cancelar"})})]})]}):(0,a.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-medium mb-4 text-[#222222]",children:"Busca un libro para a\xf1adir"}),(0,a.jsx)(E,{onSelectBook:e=>{D({...I,title:e.title,author:e.author,published_date:e.publishedDate,description:e.description,categories:e.categories,thumbnail:e.thumbnail,page_count:e.pageCount,publisher:e.publisher,isbn:e.isbn}),B(!0),L(!1),$(!1),V(!1)},initialQuery:""}),(0,a.jsxs)("div",{className:"mt-6 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"\xbfNo encuentras el libro que buscas?"}),(0,a.jsx)(o.$,{variant:"outline",className:"text-[#FFA69E]",onClick:()=>B(!0),children:"A\xf1adir manualmente"})]})]})]})})}},550:(e,s,t)=>{"use strict";async function a(e){try{let s=encodeURIComponent(e),t=await fetch("https://www.googleapis.com/books/v1/volumes?q=".concat(s,"&maxResults=5"));if(!t.ok)throw Error("Error en la b\xfasqueda: ".concat(t.statusText));return(await t.json()).items||[]}catch(e){return console.error("Error al buscar libros:",e),[]}}function l(e){var s,t,a,l,r;let{volumeInfo:i}=e,n="";return i.imageLinks&&(n=(r=n=i.imageLinks.large||i.imageLinks.medium||i.imageLinks.small||i.imageLinks.thumbnail||i.imageLinks.smallThumbnail||"")?r.includes("books.google.com")?r.includes("zoom=")?r.replace(/zoom=\d/,"zoom=2"):r.includes("?")?"".concat(r,"&zoom=2"):"".concat(r,"?zoom=2"):r:"",i.title.includes("olvido")&&e.id&&(n="https://books.google.com/books/content?id=".concat(e.id,"&printsec=frontcover&img=1&zoom=3&source=gbs_api"))),{title:i.title||"",author:i.authors?i.authors.join(", "):"",publishedDate:i.publishedDate||"",description:i.description||"",categories:i.categories||[],thumbnail:n,pageCount:i.pageCount||0,publisher:i.publisher||"",isbn:(null===(t=i.industryIdentifiers)||void 0===t?void 0:null===(s=t.find(e=>"ISBN_13"===e.type))||void 0===s?void 0:s.identifier)||(null===(l=i.industryIdentifiers)||void 0===l?void 0:null===(a=l.find(e=>"ISBN_10"===e.type))||void 0===a?void 0:a.identifier)||""}}t.d(s,{Ve:()=>a,Xw:()=>l})},643:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7211).A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},1569:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7211).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},1800:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7211).A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},2280:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7211).A)("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]])},3074:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7211).A)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},3345:(e,s,t)=>{"use strict";t.d(s,{E:()=>r});var a=t(4727),l=t(6119);function r(e){let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,l.cn)("animate-pulse rounded-md bg-muted",s),...t})}},5499:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(7211).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9190:(e,s,t)=>{Promise.resolve().then(t.bind(t,510))}},e=>{var s=s=>e(e.s=s);e.O(0,[228,520,317,735,79,296,358],()=>s(9190)),_N_E=e.O()}]);