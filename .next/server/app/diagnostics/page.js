(()=>{var e={};e.id=149,e.ids=[149],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10563:(e,r,s)=>{"use strict";s.d(r,{F6:()=>n,iD:()=>o,ri:()=>i,wR:()=>a});let t=s(35172).X9;function a(){return!1}function o(e){if("dayko"===e)try{return localStorage.setItem(t,"authenticated"),!0}catch(e){console.error("Error al guardar estado de autenticaci\xf3n:",e)}return!1}function i(){try{localStorage.removeItem(t),document.cookie="auth-status=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"}catch(e){console.error("Error al cerrar sesi\xf3n:",e)}}function n(){return"aebaf7a8-0d83-403c-b5f4-9d798b74e3ee"}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},17050:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>t});let t=(0,s(47135).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/mlucchesi/cursor_personal/app/diagnostics/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/mlucchesi/cursor_personal/app/diagnostics/page.tsx","default")},18841:(e,r,s)=>{"use strict";s.d(r,{B:()=>a});var t=s(60647);let a=(0,t.createServerReference)("00478ff53a27e04f76aa952f3b5e32f32d3de84303",t.callServer,void 0,t.findSourceMapURL,"syncPendingBooksAction")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19748:(e,r,s)=>{"use strict";s.d(r,{UU:()=>i});var t=s(30417);let a=null;function o(){return process.env.NEXT_PUBLIC_SUPABASE_URL&&process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY?a||(a=(0,t.createClientComponentClient)({supabaseUrl:process.env.NEXT_PUBLIC_SUPABASE_URL,supabaseKey:process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,options:{auth:{persistSession:!0,storageKey:"giuli-reading-app-auth",autoRefreshToken:!0,detectSessionInUrl:!0}}})):null}let i=()=>o();o()},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},35172:(e,r,s)=>{"use strict";s.d(r,{HQ:()=>t,X9:()=>a}),process.env.NEXT_PUBLIC_SITE_URL;let t="mis-lecturas-books",a="mis-lecturas-auth"},37120:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(21294).A)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},43443:(e,r,s)=>{Promise.resolve().then(s.bind(s,17050))},52285:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(21294).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64228:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(21294).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},74075:e=>{"use strict";e.exports=require("zlib")},74768:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>k});var t=s(26611),a=s(35334),o=s(1282),i=s.n(o),n=s(46318),l=s(64228),c=s(52285),d=s(37120),u=s(21294);let p=(0,u.A)("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),m=(0,u.A)("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);var x=s(19748),h=s(10563);async function b(){try{console.log("Iniciando prueba de conexi\xf3n a Supabase...");let e=(0,x.UU)(),{data:r,error:s}=await e.from("books").select("id").limit(1);if(s)return console.error("Error en la prueba de conexi\xf3n:",s),{success:!1,error:"Error al conectar con Supabase",details:s};return console.log("Conexi\xf3n exitosa a Supabase:",r),{success:!0,data:r}}catch(e){return console.error("Excepci\xf3n en la prueba de conexi\xf3n:",e),{success:!1,error:"Error al conectar con Supabase",details:e}}}async function f(){try{console.log("Verificando tabla books...");let e=(0,x.UU)(),{data:r,error:s}=await e.from("books").select("*").limit(1);if(s)return console.error("Error al verificar tabla books:",s),{success:!1,message:"Error al verificar tabla books",error:s};return console.log("Tabla books verificada:",r),{success:!0,message:"La tabla books existe",sample:r}}catch(e){return console.error("Excepci\xf3n al verificar tabla books:",e),{success:!1,message:"Error al verificar tabla books",error:e}}}async function y(){try{console.log("Probando pol\xedticas RLS...");let e=(0,x.UU)(),r=(0,h.F6)();console.log("ID de usuario para prueba RLS:",r);let{data:s,error:t}=await e.from("information_schema.columns").select("column_name").eq("table_name","books").eq("column_name","local_id").single(),a=!t&&s;console.log("\xbfExiste la columna local_id?",a?"S\xed":"No");let o={title:"Libro de prueba RLS",author:"Sistema",type:"read",user_id:r};a&&(o.local_id=`test-${Date.now()}`),console.log("Intentando insertar libro de prueba:",o);let{data:i,error:n}=await e.from("books").insert([o]).select();if(n)return console.error("Error al insertar libro de prueba (posible problema con RLS):",n),{success:!1,error:"Error al insertar un libro de prueba (posible problema con RLS)",details:n,hasLocalIdColumn:a};if(console.log("Libro de prueba insertado correctamente:",i),i&&i.length>0){let{error:r}=await e.from("books").delete().eq("id",i[0].id);r?console.error("Error al eliminar libro de prueba:",r):console.log("Libro de prueba eliminado correctamente")}return{success:!0,message:"Las pol\xedticas RLS permiten insertar libros",hasLocalIdColumn:a}}catch(e){return console.error("Excepci\xf3n al probar pol\xedticas RLS:",e),{success:!1,error:"Error al probar pol\xedticas RLS",details:e}}}async function g(){try{let e=(0,h.F6)();return console.log("ID de usuario actual:",e),{success:!0,userId:e}}catch(e){return console.error("Error al obtener ID de usuario:",e),{success:!1,error:"Error al obtener ID de usuario",details:e}}}async function v(){let e=await b(),r=await f(),s=await y();return{connection:e,table:r,rls:s,userId:await g(),localStorage:{success:!1,error:"Ejecutando en servidor"}}}s(35172);var j=s(18841),N=s(37269),_=s(86455);function k(){let[e,r]=(0,a.useState)(!1),[s,o]=(0,a.useState)({}),[u,x]=(0,a.useState)([]),h=async()=>{r(!0),o({});try{let e=await v();o(e),console.log("Resultados completos:",e),x((0,_.M7)())}catch(e){console.error("Error en diagn\xf3stico:",e),o(r=>({...r,error:e}))}finally{r(!1)}},b=async()=>{r(!0);try{let e=await (0,j.B)();e.success?(0,N.o)({title:"Sincronizaci\xf3n completada",description:e.message}):(0,N.o)({title:"Error de sincronizaci\xf3n",description:e.message,variant:"destructive"}),o(r=>({...r,sync:e})),x((0,_.M7)())}catch(e){console.error("Error al sincronizar:",e),(0,N.o)({title:"Error de sincronizaci\xf3n",description:"Ocurri\xf3 un error inesperado",variant:"destructive"})}finally{r(!1)}},f=async()=>{r(!0);try{let e=await (0,_.HQ)();e.success?(0,N.o)({title:"Inicializaci\xf3n completada",description:`Se cargaron ${e.count} libros desde Supabase`}):(0,N.o)({title:"Error de inicializaci\xf3n",description:"No se pudieron cargar los libros desde Supabase",variant:"destructive"}),o(r=>({...r,init:e})),x((0,_.M7)())}catch(e){console.error("Error al inicializar:",e),(0,N.o)({title:"Error de inicializaci\xf3n",description:"Ocurri\xf3 un error inesperado",variant:"destructive"})}finally{r(!1)}};return(0,t.jsx)("div",{className:"min-h-screen bg-[#FDFCFB] p-6",children:(0,t.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,t.jsxs)("header",{className:"mb-8 flex items-center",children:[(0,t.jsx)(i(),{href:"/dashboard",className:"mr-4",children:(0,t.jsx)(l.A,{className:"h-5 w-5 text-[#888888]"})}),(0,t.jsx)("h1",{className:"font-serif text-2xl font-normal text-[#222222]",children:"Diagn\xf3stico"})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-4 font-serif text-xl text-[#222222]",children:"Herramientas de diagn\xf3stico"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(n.$,{className:"w-full justify-start",variant:"outline",onClick:h,disabled:e,children:[e?(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(d.A,{className:"mr-2 h-4 w-4"}),"Verificar conexi\xf3n con Supabase"]}),(0,t.jsxs)(n.$,{className:"w-full justify-start",variant:"outline",onClick:b,disabled:e,children:[e?(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(p,{className:"mr-2 h-4 w-4"}),"Sincronizar libros pendientes"]}),(0,t.jsxs)(n.$,{className:"w-full justify-start",variant:"outline",onClick:f,disabled:e,children:[e?(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(m,{className:"mr-2 h-4 w-4"}),"Reinicializar almacenamiento local"]})]})]}),Object.keys(s).length>0&&(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-4 font-serif text-xl text-[#222222]",children:"Resultados"}),(0,t.jsx)("pre",{className:"bg-gray-100 p-4 rounded-lg text-xs overflow-auto max-h-96",children:JSON.stringify(s,null,2)})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"mb-4 font-serif text-xl text-[#222222]",children:"Libros en almacenamiento local"}),u.length>0?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{className:"text-sm text-[#888888]",children:["Total: ",u.length," libros"]}),(0,t.jsxs)("p",{className:"text-sm text-[#888888]",children:["Pendientes de sincronizar: ",u.filter(e=>e.pending_sync).length," libros"]}),(0,t.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg text-xs overflow-auto max-h-96",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left p-1",children:"ID"}),(0,t.jsx)("th",{className:"text-left p-1",children:"T\xedtulo"}),(0,t.jsx)("th",{className:"text-left p-1",children:"Autor"}),(0,t.jsx)("th",{className:"text-left p-1",children:"Tipo"}),(0,t.jsx)("th",{className:"text-left p-1",children:"Pendiente"})]})}),(0,t.jsx)("tbody",{children:u.map(e=>(0,t.jsxs)("tr",{className:"border-t border-gray-200",children:[(0,t.jsx)("td",{className:"p-1",children:e.id||e.local_id}),(0,t.jsx)("td",{className:"p-1",children:e.title}),(0,t.jsx)("td",{className:"p-1",children:e.author}),(0,t.jsx)("td",{className:"p-1",children:e.type}),(0,t.jsx)("td",{className:"p-1",children:e.pending_sync?"S\xed":"No"})]},e.id||e.local_id))})]})})]}):(0,t.jsx)("p",{className:"text-center text-[#888888]",children:"No hay libros en el almacenamiento local"})]})]})]})})}},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80395:(e,r,s)=>{Promise.resolve().then(s.bind(s,74768))},81630:e=>{"use strict";e.exports=require("http")},82107:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var t=s(72659),a=s(95420),o=s(76446),i=s.n(o),n=s(70377),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(r,l);let c={children:["",{children:["diagnostics",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,17050)),"/Users/mlucchesi/cursor_personal/app/diagnostics/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,11046)),"/Users/mlucchesi/cursor_personal/app/layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,90462)),"/Users/mlucchesi/cursor_personal/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,13322,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,73003,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,78800,23)),"next/dist/client/components/unauthorized-error"]}]}.children,d=["/Users/mlucchesi/cursor_personal/app/diagnostics/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/diagnostics/page",pathname:"/diagnostics",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},86455:(e,r,s)=>{"use strict";function t(){return console.log("getLocalBooks: Ejecutando en servidor, retornando array vac\xedo"),[]}async function a(){return console.log("initializeLocalStorage: Ejecutando en servidor, no se puede inicializar"),{success:!1,count:0}}s.d(r,{HQ:()=>a,M7:()=>t}),s(19748),s(10563),s(35172)},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[607,397,746,31,417,468,255],()=>s(82107));module.exports=t})();